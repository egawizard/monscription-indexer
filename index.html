<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monscription Indexer</title>
    <meta name="description" content="Indexer monscription di jaringan Monad Testnet. Cari ticker, lihat total supply, holders, top holders, progress mint, dsb." />

    <!-- Tailwind Play CDN (no build tools needed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "ui-sans-serif", "system-ui", "-apple-system", "Segoe UI", "Roboto", "Ubuntu", "Cantarell", "Noto Sans", "Helvetica Neue", "Arial", "\"Apple Color Emoji\"", "\"Segoe UI Emoji\""]
            },
            colors: {
              base: {
                900: "#0b0f17",
                800: "#0f1726",
                700: "#151f33",
                600: "#1f2b45",
                500: "#2a3758"
              },
              primary: {
                500: "#5b9dff",
                400: "#84b4ff",
                300: "#b2cfff"
              }
            },
            boxShadow: {
              glass: "0 10px 30px rgba(0,0,0,0.35)"
            }
          }
        }
      }
    </script>

    <!-- Ethers v6 -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.min.js"></script>

    <style>
      /* Subtle animated gradient background */
      .bg-grid {
        background-image: radial-gradient(rgba(255,255,255,0.08) 1px, transparent 1px);
        background-size: 18px 18px;
        background-position: -10px -10px;
      }
      .glass {
        background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
        backdrop-filter: blur(8px);
      }
      .mono { font-variant-numeric: tabular-nums; }
      .fade-in { animation: fade .5s ease-out; }
      @keyframes fade { from { opacity: 0; transform: translateY(4px);} to { opacity: 1; transform: translateY(0);} }
    </style>
  </head>

  <body class="min-h-screen bg-base-900 text-white font-sans bg-grid">
    <header class="relative z-10">
      <div class="mx-auto max-w-7xl px-4 py-8 lg:py-10">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-semibold tracking-tight">Monscription Indexer</h1>
            <p class="text-white/70 mt-2 max-w-2xl">
              Masukkan <span class="font-semibold">ticker</span> untuk melihat info token: total supply, holders, top holders, progress mint, dan lainnya. Semua tampilan menggunakan <span class="font-semibold">18 decimals</span>.
            </p>
          </div>
          <a href="https://mons-mon-20.vercel.app/" target="_blank" class="rounded-xl bg-primary-500/10 hover:bg-primary-500/20 transition px-4 py-2 text-primary-300 border border-primary-500/30">Mint ↗</a>
        </div>

        <div class="mt-6 flex flex-wrap items-center gap-3 text-xs text-white/60">
          <span class="px-2 py-1 rounded bg-white/5 border border-white/10">Chain: Monad Testnet</span>
          <span class="px-2 py-1 rounded bg-white/5 border border-white/10">Chain ID: 10143</span>
          <span class="px-2 py-1 rounded bg-white/5 border border-white/10">RPC: testnet-rpc.monad.xyz</span>
          <span class="px-2 py-1 rounded bg-white/5 border border-white/10">Contract: <code class="mono">0x07169f0F890C3595421512D98DC79b8bce6E5fA6</code></span>
        </div>
      </div>
    </header>

    <main class="relative z-10">
      <div class="mx-auto max-w-7xl px-4 pb-24">
        <!-- Search Card -->
        <section class="glass shadow-glass rounded-3xl p-5 sm:p-6 lg:p-8 border border-white/10">
          <div class="flex flex-col md:flex-row md:items-end gap-4">
            <div class="flex-1">
              <label class="block text-sm text-white/70 mb-2">Ticker</label>
              <input id="tickerInput" type="text" placeholder="cth: MONS" class="w-full rounded-2xl bg-base-800/80 border border-white/10 px-4 py-3 outline-none focus:border-primary-400 text-base placeholder-white/30 uppercase" />
            </div>
            <div class="flex items-center gap-3">
              <button id="btnLookup" class="rounded-2xl bg-primary-500 hover:bg-primary-400 transition px-5 py-3 font-medium">Cari</button>
              <button id="btnExample" class="rounded-2xl bg-white/5 hover:bg-white/10 transition px-5 py-3">Contoh: MONS</button>
            </div>
          </div>
          <p id="hint" class="text-xs text-white/50 mt-3">Tip: Kamu bisa tekan <kbd class="px-1.5 py-0.5 rounded bg-white/10">Enter</kbd> setelah mengetik ticker.</p>
        </section>

        <!-- Results Grid -->
        <section id="results" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
          <!-- Left: Summary -->
          <div class="lg:col-span-1 space-y-6">
            <div class="glass rounded-3xl border border-white/10 p-6 shadow-glass">
              <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold">Ringkasan Token</h2>
                <span id="tokenBadge" class="text-xs px-2.5 py-1 rounded bg-white/5 border border-white/10 text-white/60">—</span>
              </div>
              <div id="summary" class="mt-4 space-y-3 text-sm">
                <div class="flex justify-between"><span class="text-white/60">Ticker</span><span id="sTick" class="font-medium">—</span></div>
                <div class="flex justify-between"><span class="text-white/60">Deployer</span><a id="sDeployer" class="font-medium underline decoration-dotted" target="_blank">—</a></div>
                <div class="flex justify-between"><span class="text-white/60">Max Supply</span><span id="sMax" class="font-medium mono">—</span></div>
                <div class="flex justify-between"><span class="text-white/60">Minted</span><span id="sMinted" class="font-medium mono">—</span></div>
                <div class="flex justify-between"><span class="text-white/60">Limit / Mint</span><span id="sLimit" class="font-medium mono">—</span></div>
                <div class="flex justify-between"><span class="text-white/60">Holders</span><span id="sHolders" class="font-medium">—</span></div>
              </div>
              <div class="mt-6">
                <div class="flex justify-between text-xs text-white/60 mb-2">
                  <span>Progress Mint</span>
                  <span id="sPct">0%</span>
                </div>
                <div class="h-3 w-full rounded-full bg-white/10 overflow-hidden">
                  <div id="progressBar" class="h-full w-0 bg-primary-500 transition-all duration-500"></div>
                </div>
              </div>
            </div>

            <div class="glass rounded-3xl border border-white/10 p-6 shadow-glass">
              <h3 class="text-lg font-semibold">Balance Kamu</h3>
              <p class="text-xs text-white/60">(Opsional) sambungkan wallet untuk mengecek balance ticker ini.</p>
              <div class="mt-3 flex items-center gap-3">
                <button id="btnConnect" class="rounded-xl bg-white/10 hover:bg-white/20 transition px-4 py-2">Connect Wallet</button>
                <span id="youAddr" class="text-sm text-white/70">—</span>
              </div>
              <div class="mt-3 text-sm">
                <div class="flex justify-between"><span class="text-white/60">Balance</span><span id="youBal" class="mono">—</span></div>
              </div>
            </div>

            <div class="glass rounded-3xl border border-white/10 p-6 shadow-glass text-sm">
              <div class="flex items-center gap-2">
                <span class="opacity-70">Created by</span>
                <a class="underline decoration-dotted" href="https://x.com/ega_2ez4crypto" target="_blank">@ega_2ez4crypto</a>
              </div>
            </div>
          </div>

          <!-- Right: Holders Table -->
          <div class="lg:col-span-2 space-y-6">
            <div class="glass rounded-3xl border border-white/10 p-6 shadow-glass">
              <div class="flex items-center justify-between gap-2">
                <h2 class="text-lg font-semibold">Top Holders</h2>
                <div class="flex items-center gap-2 text-sm">
                  <label class="text-white/60">Tampilkan</label>
                  <select id="rowLimit" class="rounded-lg bg-base-800/80 border border-white/10 px-2 py-1 outline-none">
                    <option>25</option>
                    <option selected>50</option>
                    <option>100</option>
                  </select>
                  <button id="btnCSV" class="rounded-lg bg-white/10 hover:bg-white/20 transition px-3 py-1 text-sm">Export CSV</button>
                </div>
              </div>
              <div id="tableWrap" class="mt-4 overflow-auto rounded-2xl border border-white/10">
                <table class="min-w-full text-sm">
                  <thead class="bg-white/5">
                    <tr>
                      <th class="text-left px-4 py-3 font-medium">#</th>
                      <th class="text-left px-4 py-3 font-medium">Address</th>
                      <th class="text-right px-4 py-3 font-medium">Balance (18d)</th>
                      <th class="text-right px-4 py-3 font-medium">% of Minted</th>
                    </tr>
                  </thead>
                  <tbody id="holdersBody" class="divide-y divide-white/5"></tbody>
                </table>
              </div>
              <p id="tableHint" class="text-xs text-white/50 mt-3">Catatan: Disortir berdasarkan balance tertinggi. Persentase dihitung terhadap total minted saat ini.</p>
            </div>

            <div class="glass rounded-3xl border border-white/10 p-6 shadow-glass">
              <h2 class="text-lg font-semibold">Log</h2>
              <pre id="log" class="mt-3 text-xs whitespace-pre-wrap leading-relaxed text-white/70"></pre>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="relative z-10 border-t border-white/10/50">
      <div class="mx-auto max-w-7xl px-4 py-8 text-sm text-white/60">
        © <span id="year"></span> Monscription Indexer · Dibuat untuk Monad Testnet · Kredensial kontrak publik.
      </div>
    </footer>

    <script>
      // ============================
      // Config
      // ============================
      const RPC_URL = "https://testnet-rpc.monad.xyz";
      const CHAIN_ID = 10143;
      const CONTRACT_ADDRESS = "0x07169f0F890C3595421512D98DC79b8bce6E5fA6";
      const DECIMALS = 18; // force 18d visualization

      const ABI = [
        { "inputs": [], "stateMutability": "nonpayable", "type": "constructor" },
        { "anonymous": false, "inputs": [ { "indexed": true, "internalType": "string", "name": "tick", "type": "string" }, { "indexed": false, "internalType": "uint256", "name": "maxSupply", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "limitPerMint", "type": "uint256" }, { "indexed": false, "internalType": "address", "name": "deployer", "type": "address" } ], "name": "Deploy", "type": "event" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" }, { "internalType": "uint256", "name": "maxSupply", "type": "uint256" }, { "internalType": "uint256", "name": "limitPerMint", "type": "uint256" } ], "name": "deployToken", "outputs": [], "stateMutability": "payable", "type": "function" },
        { "inputs": [ { "internalType": "address", "name": "token", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" } ], "name": "emergencyWithdraw", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
        { "anonymous": false, "inputs": [ { "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": true, "internalType": "string", "name": "tick", "type": "string" }, { "indexed": false, "internalType": "string", "name": "operation", "type": "string" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }, { "indexed": false, "internalType": "string", "name": "data", "type": "string" }, { "indexed": false, "internalType": "uint256", "name": "inscriptionNumber", "type": "uint256" } ], "name": "Inscribe", "type": "event" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" }, { "internalType": "uint256", "name": "amount", "type": "uint256" } ], "name": "mint", "outputs": [], "stateMutability": "payable", "type": "function" },
        { "inputs": [ { "internalType": "uint256", "name": "newFee", "type": "uint256" } ], "name": "setDeployFee", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
        { "inputs": [ { "internalType": "uint256", "name": "newFee", "type": "uint256" } ], "name": "setMintFee", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
        { "inputs": [ { "internalType": "address", "name": "to", "type": "address" }, { "internalType": "string", "name": "tick", "type": "string" }, { "internalType": "uint256", "name": "amount", "type": "uint256" } ], "name": "transfer", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
        { "inputs": [], "name": "withdraw", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
        { "stateMutability": "payable", "type": "receive" },
        { "inputs": [ { "internalType": "address", "name": "", "type": "address" }, { "internalType": "string", "name": "", "type": "string" } ], "name": "balances", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [], "name": "deployFee", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "address", "name": "user", "type": "address" }, { "internalType": "string", "name": "tick", "type": "string" } ], "name": "getBalance", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" } ], "name": "getHolders", "outputs": [ { "internalType": "address[]", "name": "", "type": "address[]" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" } ], "name": "getHoldersCount", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" } ], "name": "getMintProgress", "outputs": [ { "internalType": "uint256", "name": "minted", "type": "uint256" }, { "internalType": "uint256", "name": "maxSupply", "type": "uint256" }, { "internalType": "uint256", "name": "percentage", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" } ], "name": "getTokenInfo", "outputs": [ { "internalType": "uint256", "name": "maxSupply", "type": "uint256" }, { "internalType": "uint256", "name": "limitPerMint", "type": "uint256" }, { "internalType": "uint256", "name": "minted", "type": "uint256" }, { "internalType": "address", "name": "deployer", "type": "address" }, { "internalType": "uint256", "name": "holdersCount", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "tick", "type": "string" } ], "name": "getTotalMinted", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "", "type": "string" }, { "internalType": "uint256", "name": "", "type": "uint256" } ], "name": "holders", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [], "name": "inscriptionCounter", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "", "type": "string" }, { "internalType": "address", "name": "", "type": "address" } ], "name": "isHolder", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [], "name": "mintFee", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [], "name": "owner", "outputs": [ { "internalType": "address", "name": "", "type": "address" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "", "type": "string" } ], "name": "tokens", "outputs": [ { "internalType": "uint256", "name": "maxSupply", "type": "uint256" }, { "internalType": "uint256", "name": "limitPerMint", "type": "uint256" }, { "internalType": "address", "name": "deployer", "type": "address" }, { "internalType": "bool", "name": "exists", "type": "bool" }, { "internalType": "uint256", "name": "deployedAt", "type": "uint256" } ], "stateMutability": "view", "type": "function" },
        { "inputs": [ { "internalType": "string", "name": "", "type": "string" } ], "name": "totalMinted", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }
      ];

      // ============================
      // Utils
      // ============================
      const logEl = document.getElementById('log');
      function log(msg) {
        const time = new Date().toLocaleTimeString();
        logEl.textContent += `[${time}] ${msg}\n`;
        logEl.scrollTop = logEl.scrollHeight;
      }
      function fmtUnits(v) { try { return ethers.formatUnits(v, DECIMALS); } catch { return "0"; } }
      function fmtNum(x, max=6) {
        // trim trailing zeros for nice display
        const parts = x.split('.');
        if (parts.length === 1) return x;
        let [a,b] = parts;
        b = b.slice(0, max).replace(/0+$/,'');
        return b ? `${a}.${b}` : a;
      }
      function pctStr(n) { return `${Number(n).toFixed(2)}%`; }
      function shorten(addr) { return addr ? addr.slice(0,6)+"…"+addr.slice(-4) : '—'; }

      // simple concurrency limiter for RPC calls
      async function mapLimit(arr, limit, iter) {
        const ret = [];
        let i = 0;
        const exec = async () => {
          while (i < arr.length) {
            const cur = i++;
            ret[cur] = await iter(arr[cur], cur);
          }
        };
        const workers = Array(Math.min(limit, arr.length)).fill(0).map(exec);
        await Promise.all(workers);
        return ret;
      }

      // ============================
      // Blockchain objects
      // ============================
      const provider = new ethers.JsonRpcProvider(RPC_URL, { chainId: CHAIN_ID, name: 'monad-testnet' });
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

      let signer = null;
      let you = null;

      async function connectWallet() {
        if (!window.ethereum) { alert('Wallet tidak ditemukan. Silakan install MetaMask.'); return; }
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const web3p = new ethers.BrowserProvider(window.ethereum);
        signer = await web3p.getSigner();
        you = await signer.getAddress();
        document.getElementById('youAddr').textContent = shorten(you);
        log('Wallet tersambung: '+you);
      }

      async function ensureTickerExists(tick) {
        // read tokens mapping to confirm exists
        try {
          const t = await contract.tokens(tick);
          return t.exists;
        } catch (e) {
          return false;
        }
      }

      async function lookupTicker(rawTick) {
        const tick = (rawTick||'').trim().toUpperCase();
        if (!tick) { alert('Isi ticker dulu.'); return; }
        log('Mencari ticker '+tick+' …');

        // UI: reset
        document.getElementById('tokenBadge').textContent = 'Loading…';
        document.getElementById('holdersBody').innerHTML = '';
        document.getElementById('sTick').textContent = tick;
        document.getElementById('sDeployer').textContent = '—';
        document.getElementById('sDeployer').removeAttribute('href');
        document.getElementById('sMax').textContent = '—';
        document.getElementById('sMinted').textContent = '—';
        document.getElementById('sLimit').textContent = '—';
        document.getElementById('sHolders').textContent = '—';
        document.getElementById('sPct').textContent = '0%';
        document.getElementById('progressBar').style.width = '0%';

        try {
          const exists = await ensureTickerExists(tick);
          if (!exists) {
            document.getElementById('tokenBadge').textContent = 'Ticker tidak ditemukan';
            log('Ticker tidak ditemukan. Pastikan sudah benar dan sudah deploy.');
            return;
          }

          const info = await contract.getTokenInfo(tick);
          const maxSupply = info.maxSupply;
          const limitPerMint = info.limitPerMint;
          const minted = info.minted;
          const deployer = info.deployer;
          const holdersCount = info.holdersCount;

          const maxStr = fmtNum(fmtUnits(maxSupply));
          const mintedStr = fmtNum(fmtUnits(minted));
          const limitStr = fmtNum(fmtUnits(limitPerMint));

          document.getElementById('sDeployer').textContent = shorten(deployer);
          document.getElementById('sDeployer').href = `https://monadscan.org/address/${deployer}`;
          document.getElementById('sMax').textContent = maxStr;
          document.getElementById('sMinted').textContent = mintedStr;
          document.getElementById('sLimit').textContent = limitStr;
          document.getElementById('sHolders').textContent = holdersCount.toString();
          document.getElementById('tokenBadge').textContent = 'OK';

          // progress
          const pct = Number((BigInt(minted) * 10000n) / (BigInt(maxSupply) || 1n)) / 100; // 2 decimals
          document.getElementById('sPct').textContent = pctStr(pct);
          document.getElementById('progressBar').style.width = `${Math.min(100, pct)}%`;

          // your balance if connected
          if (you) {
            try {
              const yb = await contract.getBalance(you, tick);
              document.getElementById('youBal').textContent = fmtNum(fmtUnits(yb));
            } catch {}
          }

          // fetch holders + balances
          log('Mengambil daftar holders…');
          const holders = await contract.getHolders(tick);
          log(`Total holders dari kontrak: ${holders.length}`);

          const concurrency = 8; // keep RPC polite
          log('Mengambil balance setiap holder (batched)…');
          const balances = await mapLimit(holders, concurrency, async (addr) => {
            try {
              const bal = await contract.getBalance(addr, tick);
              return { addr, bal: BigInt(bal) };
            } catch (e) {
              return { addr, bal: 0n };
            }
          });

          // sort desc, filter zero
          const nonZero = balances.filter(b => b.bal > 0n);
          nonZero.sort((a,b) => (a.bal > b.bal ? -1 : a.bal < b.bal ? 1 : 0));

          const mintedBI = BigInt(minted);
          const mintedNonZero = mintedBI === 0n ? 1n : mintedBI;

          // render table
          const body = document.getElementById('holdersBody');
          body.innerHTML = '';

          const limit = parseInt(document.getElementById('rowLimit').value, 10) || 50;
          nonZero.slice(0, limit).forEach((row, i) => {
            const tr = document.createElement('tr');
            tr.className = 'hover:bg-white/5 fade-in';

            const pct = Number((row.bal * 10000n) / mintedNonZero) / 100;

            tr.innerHTML = `
              <td class="px-4 py-2 text-white/70">${i+1}</td>
              <td class="px-4 py-2"><a class="underline decoration-dotted" target="_blank" href="https://monadscan.org/address/${row.addr}">${shorten(row.addr)}</a></td>
              <td class="px-4 py-2 text-right mono">${fmtNum(fmtUnits(row.bal.toString()))}</td>
              <td class="px-4 py-2 text-right">${pctStr(pct)}</td>
            `;
            body.appendChild(tr);
          });

          // CSV data cache
          window.__lastTable = nonZero.map((r, idx) => ({
            rank: idx+1,
            address: r.addr,
            balance_18d: fmtUnits(r.bal.toString()),
            percent_of_minted: (Number((r.bal * 10000n)/mintedNonZero)/100).toFixed(2)
          }));

          log('Selesai. Data berhasil dimuat.');
        } catch (e) {
          console.error(e);
          log('Gagal memuat data: '+ (e?.shortMessage || e?.message || e));
          document.getElementById('tokenBadge').textContent = 'Error';
        }
      }

      // Export CSV
      function exportCSV() {
        if (!window.__lastTable) { alert('Tidak ada data untuk diexport. Cari ticker dulu.'); return; }
        const rows = window.__lastTable;
        const header = Object.keys(rows[0]);
        const lines = [header.join(',')].concat(rows.map(r => header.map(h => r[h]).join(',')));
        const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'monscription_top_holders.csv';
        a.click();
        URL.revokeObjectURL(url);
      }

      // Events
      document.getElementById('btnLookup').addEventListener('click', () => lookupTicker(document.getElementById('tickerInput').value));
      document.getElementById('btnExample').addEventListener('click', () => {
        document.getElementById('tickerInput').value = 'MONS';
        lookupTicker('MONS');
      });
      document.getElementById('tickerInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') lookupTicker(e.target.value);
      });
      document.getElementById('rowLimit').addEventListener('change', () => {
        // rerender table using cached list if available
        if (window.__lastTable) {
          const limit = parseInt(document.getElementById('rowLimit').value, 10) || 50;
          const body = document.getElementById('holdersBody');
          body.innerHTML = '';
          window.__lastTable.slice(0, limit).forEach((r,i) => {
            const tr = document.createElement('tr');
            tr.className = 'hover:bg-white/5 fade-in';
            tr.innerHTML = `
              <td class="px-4 py-2 text-white/70">${r.rank}</td>
              <td class="px-4 py-2"><a class="underline decoration-dotted" target="_blank" href="https://monadscan.org/address/${r.address}">${shorten(r.address)}</a></td>
              <td class="px-4 py-2 text-right mono">${fmtNum(r.balance_18d)}</td>
              <td class="px-4 py-2 text-right">${Number(r.percent_of_minted).toFixed(2)}%</td>
            `;
            body.appendChild(tr);
          });
        }
      });
      document.getElementById('btnCSV').addEventListener('click', exportCSV);
      document.getElementById('btnConnect').addEventListener('click', connectWallet);

      // Init
      document.getElementById('year').textContent = new Date().getFullYear();
      // Auto-fill example on first load
      document.getElementById('tickerInput').value = 'MONS';
      lookupTicker('MONS');
    </script>
  </body>
</html>
