<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MONAD MON-20 Inscription Minter</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0e0e16; color: #fff; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .header { text-align: center; margin-bottom: 30px; }
    .stats { display: flex; gap: 20px; justify-content: center; margin-bottom: 20px; }
    .stat { background: #1a1a2b; padding: 20px; border-radius: 12px; text-align: center; flex: 1; }
    .stat h2 { margin: 0; font-size: 2rem; color: #4ecdc4; }
    .stat p { margin: 5px 0 0; opacity: 0.8; }
    .holders { background: #1a1a2b; padding: 20px; border-radius: 12px; margin-top: 20px; }
    .holder { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .holder:last-child { border-bottom: none; }
    .progress { margin: 20px 0; background: #333; border-radius: 8px; overflow: hidden; height: 20px; }
    .progress-fill { background: linear-gradient(90deg,#4ecdc4,#45b7d1); height: 100%; width: 0; transition: width 0.3s ease; }
    .footer { margin-top: 30px; text-align: center; font-size: 0.9rem; opacity: 0.7; }
    a { color: #4ecdc4; text-decoration: none; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.2/web3.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>MONAD MON-20</h1>
      <p>The First Inscription Token on MONAD Testnet ($MONS)</p>
      <p id="status">Connecting...</p>
    </div>

    <div class="stats">
      <div class="stat"><h2 id="totalMinted">0</h2><p>Total Minted</p></div>
      <div class="stat"><h2 id="remaining">21,000,000</h2><p>Remaining</p></div>
      <div class="stat"><h2 id="holders">0</h2><p>Holders</p></div>
      <div class="stat"><h2 id="mintCount">0</h2><p>Mint Count</p></div>
    </div>

    <div class="progress"><div id="progressFill" class="progress-fill"></div></div>

    <div class="holders">
      <h3>Top Holders</h3>
      <div id="holdersList"><div class="holder"><span>No holders yet</span><span>0 MONS</span></div></div>
    </div>

    <div class="footer">
      Created by <a href="https://x.com/ega_2ez4crypto" target="_blank">@ega_2ez4crypto</a><br>
      Fully decentralized • No database • All data onchain
    </div>
  </div>

  <script>
    const MONAD_CONFIG = { chainId: 10143, rpcUrl: 'https://rpc-testnet.monadinfra.com' };
    const DEPLOY_BLOCK = 32111409;
    const MAX_SUPPLY = 21000000;

    let web3;
    let inscriptionData = { totalMinted: 0, holders: new Map(), mintCount: 0, lastProcessedBlock: DEPLOY_BLOCK - 1 };

    async function initWeb3() {
      web3 = new Web3(MONAD_CONFIG.rpcUrl);
      try {
        const currentBlock = await web3.eth.getBlockNumber();
        document.getElementById('status').innerText = `Connected • Block: ${currentBlock}`;
        if (inscriptionData.lastProcessedBlock < currentBlock) {
          await indexNewBlocks(inscriptionData.lastProcessedBlock + 1, currentBlock);
        }
        setInterval(async () => {
          const latest = await web3.eth.getBlockNumber();
          if (latest > inscriptionData.lastProcessedBlock) {
            await indexNewBlocks(inscriptionData.lastProcessedBlock + 1, latest);
          }
        }, 30000);
      } catch (err) {
        document.getElementById('status').innerText = 'Failed: ' + err.message;
      }
    }

    async function indexNewBlocks(fromBlock, toBlock) {
      for (let i = fromBlock; i <= toBlock; i++) {
        const block = await web3.eth.getBlock(i, true);
        if (!block || !block.transactions) continue;
        for (const tx of block.transactions) {
          try {
            const fullTx = await web3.eth.getTransaction(tx.hash);
            if (fullTx && fullTx.input && fullTx.input !== '0x' && fullTx.from && fullTx.to && fullTx.from.toLowerCase() === fullTx.to.toLowerCase()) {
              processTransaction(fullTx);
            }
          } catch (e) {
            console.warn("Error fetching tx:", tx.hash, e);
          }
        }
        inscriptionData.lastProcessedBlock = i;
      }
      updateStats();
    }

    function processTransaction(tx) {
      try {
        const hexData = tx.input.slice(2);
        let decoded = '';
        for (let i = 0; i < hexData.length; i += 2) decoded += String.fromCharCode(parseInt(hexData.substr(i, 2), 16));
        const data = JSON.parse(decoded);
        if ((data.p === 'mon-20' || data.p === 'MON-20') && (data.op === 'mint' || data.op === 'MINT') && data.tick === 'MONS' && data.amt === '1000') {
          inscriptionData.totalMinted += 1000;
          inscriptionData.mintCount++;
          const addr = tx.from.toLowerCase();
          const bal = inscriptionData.holders.get(addr) || 0;
          inscriptionData.holders.set(addr, bal + 1000);
        }
      } catch (e) { return; }
    }

    function updateStats() {
      const minted = inscriptionData.totalMinted;
      const remaining = Math.max(0, MAX_SUPPLY - minted);
      const holders = inscriptionData.holders.size;
      const mints = inscriptionData.mintCount;
      const progress = Math.min((minted / MAX_SUPPLY) * 100, 100);

      document.getElementById('totalMinted').innerText = minted.toLocaleString();
      document.getElementById('remaining').innerText = remaining.toLocaleString();
      document.getElementById('holders').innerText = holders;
      document.getElementById('mintCount').innerText = mints;
      document.getElementById('progressFill').style.width = progress + '%';

      const holdersList = document.getElementById('holdersList');
      holdersList.innerHTML = '';
      const sorted = Array.from(inscriptionData.holders.entries()).sort((a, b) => b[1] - a[1]).slice(0, 10);
      if (sorted.length === 0) {
        holdersList.innerHTML = '<div class="holder"><span>No holders yet</span><span>0 MONS</span></div>';
        return;
      }
      sorted.forEach(([addr, bal], idx) => {
        holdersList.innerHTML += `<div class="holder"><span>#${idx+1} ${addr.slice(0,8)}...${addr.slice(-6)}</span><span>${bal.toLocaleString()} MONS</span></div>`;
      });
    }

    window.addEventListener('load', initWeb3);
  </script>
</body>
</html>
