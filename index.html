<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Monascription Indexer</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #0d1117; color: #fff; margin:0; padding:20px; }
    .card { background:#161b22; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 0 10px rgba(0,0,0,0.5);}
    .progress { background:#333; border-radius:8px; overflow:hidden; height:20px; margin-top:5px; }
    .progress-bar { background:#1f6feb; height:100%; width:0%; transition:width 0.5s; }
    .hidden { display:none; }
    button { padding:8px 16px; border:none; border-radius:8px; background:#238636; color:#fff; cursor:pointer; margin-right:5px; }
    input { padding:8px; border-radius:8px; border:1px solid #333; background:#0d1117; color:#fff; }
    ul { max-height:150px; overflow:auto; background:#0d1117; padding:10px; border-radius:8px; }
  </style>
</head>
<body>
  <h2>Monascription Indexer</h2>
  <p>RPC: <span id="rpcUrl"></span></p>

  <div>
    <input type="text" id="tickInput" placeholder="Enter tick (e.g. MONS)">
    <button id="searchBtn">Search</button>
    <button id="btnMons">Show MONS</button>
  </div>

  <div id="summary" class="card hidden">
    <h3><span id="outTick"></span></h3>
    <p><b>Deployer:</b> <span id="outDeployer"></span></p>
    <p><b>Max Supply:</b> <span id="outMax"></span></p>
    <p><b>Limit per Mint:</b> <span id="outLimit"></span></p>
    <p><b>Minted:</b> <span id="outMinted"></span></p>
    <div class="progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="mintProgress"></p>
  </div>

  <div id="extra" class="card hidden">
    <p><b>Holders Count:</b> <span id="holdersCount"></span></p>
    <ul id="holdersList"></ul>
    <p><b>Total Minted:</b> <span id="totalMinted"></span></p>
  </div>

  <pre id="log"></pre>

  <script>
  (function(){
    const RPC_URL = 'https://testnet-rpc.monad.xyz';
    const CONTRACT_ADDRESS = '0x07169f0F890C3595421512D98DC79b8bce6E5fA6';

    // === ABI kontrak kamu paste full di sini ===
    const ABI = [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "string", "name": "tick", "type": "string" },
          { "indexed": false, "internalType": "uint256", "name": "maxSupply", "type": "uint256" },
          { "indexed": false, "internalType": "uint256", "name": "limitPerMint", "type": "uint256" },
          { "indexed": false, "internalType": "address", "name": "deployer", "type": "address" }
        ],
        "name": "Deploy",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "tick", "type": "string" }
        ],
        "name": "getTokenInfo",
        "outputs": [
          { "internalType": "uint256", "name": "maxSupply", "type": "uint256" },
          { "internalType": "uint256", "name": "limitPerMint", "type": "uint256" },
          { "internalType": "uint256", "name": "minted", "type": "uint256" },
          { "internalType": "address", "name": "deployer", "type": "address" },
          { "internalType": "uint256", "name": "holdersCount", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "tick", "type": "string" }
        ],
        "name": "getHolders",
        "outputs": [
          { "internalType": "address[]", "name": "", "type": "address[]" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

    const rpcEl = document.getElementById('rpcUrl');
    const tickInput = document.getElementById('tickInput');
    const outTick = document.getElementById('outTick');
    const outDeployer = document.getElementById('outDeployer');
    const outMax = document.getElementById('outMax');
    const outLimit = document.getElementById('outLimit');
    const outMinted = document.getElementById('outMinted');
    const progressBar = document.getElementById('progressBar');
    const mintProgressEl = document.getElementById('mintProgress');
    const totalMintedEl = document.getElementById('totalMinted');
    const holdersCountEl = document.getElementById('holdersCount');
    const holdersList = document.getElementById('holdersList');
    const summary = document.getElementById('summary');
    const extra = document.getElementById('extra');
    const logEl = document.getElementById('log');

    rpcEl.textContent = RPC_URL;

    async function loadTick(tick){
      tick = String(tick || '').trim();
      if (!tick) return alert('Enter a tick name (e.g. MONS)');
      logEl.textContent = 'Loading ' + tick + ' ...';

      try {
        const info = await contract.getTokenInfo(tick);

        // Ganti decimals sesuai kontrak: 0 (integer) atau 18
        const decimals = 0;  

        const maxSupply = ethers.utils.formatUnits(info.maxSupply, decimals);
        const limitPerMint = ethers.utils.formatUnits(info.limitPerMint, decimals);
        const minted = ethers.utils.formatUnits(info.minted, decimals);

        const maxSupplyNum = Number(maxSupply);
        const limitPerMintNum = Number(limitPerMint);
        const mintedNum = Number(minted);

        const deployer = info.deployer;
        const holdersCount = info.holdersCount.toString();

        outTick.textContent = tick;
        outDeployer.textContent = deployer;
        outMax.textContent = maxSupplyNum.toLocaleString();
        outLimit.textContent = limitPerMintNum.toLocaleString();
        outMinted.textContent = mintedNum.toLocaleString();

        const perc = (mintedNum / maxSupplyNum) * 100;
        progressBar.style.width = perc + '%';
        mintProgressEl.textContent = `Minted ${mintedNum.toLocaleString()} / ${maxSupplyNum.toLocaleString()} (${perc.toFixed(2)}%)`;
        totalMintedEl.textContent = mintedNum.toLocaleString();
        holdersCountEl.textContent = holdersCount;

        // Holders list
        const holders = await contract.getHolders(tick);
        holdersList.innerHTML = "";
        holders.forEach((addr, i)=>{
          const li = document.createElement("li");
          li.textContent = `${i+1}. ${addr}`;
          holdersList.appendChild(li);
        });

        summary.classList.remove('hidden');
        extra.classList.remove('hidden');
        logEl.textContent = 'Loaded successfully.';
      } catch (err) {
        console.error(err);
        logEl.textContent = 'Failed to load: ' + err.message;
      }
    }

    document.getElementById('searchBtn').addEventListener('click', ()=> loadTick(tickInput.value));
    tickInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') loadTick(tickInput.value); });
    document.getElementById('btnMons').addEventListener('click', ()=> { tickInput.value = 'MONS'; loadTick('MONS'); });
  })();
  </script>
</body>
</html>
